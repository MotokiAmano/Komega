<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Usage &mdash; komega 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="komega 1.0.0 documentation" href="index.html" />
    <link rel="next" title="Contact" href="komega_contact_en.html" />
    <link rel="prev" title="Schematic workflow of this library" href="komega_workflow_en.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="komega_contact_en.html" title="Contact"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="komega_workflow_en.html" title="Schematic workflow of this library"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">komega 1.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<p>The calculation is done to utilize functions by the following
procedures.</p>
<ul class="simple">
<li>Initialization (<a class="reference internal" href="#init"><em>*_init</em></a>)</li>
<li>Update results iteratively (<a class="reference internal" href="#update"><em>*_update</em></a>)</li>
<li>(Optional) Take the information for the restart (<a class="reference internal" href="#getcoef"><em>*_getcoef</em></a>, <a class="reference internal" href="#getvec"><em>*_getvec</em></a>)</li>
<li>Finalization (<a class="reference internal" href="#finalize"><em>*_finalize</em></a>)</li>
</ul>
<p>The restart calculation can be done by the following procedures.</p>
<ul class="simple">
<li>Initialization with the information of the previous calculation (<a class="reference internal" href="#restart"><em>*_restart</em></a>)</li>
<li>Update results iteratively (<a class="reference internal" href="#update"><em>*_update</em></a>)</li>
<li>(Optional) Take the information for the further restart (<a class="reference internal" href="#getcoef"><em>*_getcoef</em></a>, <a class="reference internal" href="#getvec"><em>*_getvec</em></a>)</li>
<li>Finalization (<a class="reference internal" href="#finalize"><em>*_finalize</em></a>)</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Since <span class="math">\(K\omega\)</span> is <strong>not</strong> thread safe,
these routine must be called from the outside of the OpenMP-parallel region.
If you want to call <span class="math">\(K\omega\)</span> routine in the parallel region
(i.e. plan to solve different equations among threads),
please add <tt class="docutils literal"><span class="pre">-D</span> <span class="pre">_KOMEGA_THREAD</span></tt> to  <tt class="docutils literal"><span class="pre">FFLAGS</span></tt> in <tt class="docutils literal"><span class="pre">make.sys</span></tt>
(<strong>Experimental</strong>).</p>
</div>
<p>For FORTRAN, the modules can be called by</p>
<div class="highlight-fortran"><div class="highlight"><pre><span class="k">USE </span><span class="nv">komega_cg_r</span> <span class="c">! Conjugate-gradient method for real vectors</span>
<span class="k">USE </span><span class="nv">komega_cg_c</span> <span class="c">! Conjugate-gradient method for complex vectors</span>
<span class="k">USE </span><span class="nv">komega_cocg</span> <span class="c">! Conjugate-orthogonal conjugate-gradient mehod</span>
<span class="k">USE </span><span class="nv">komega_bicg</span> <span class="c">! Biconjugate-gradient method</span>
</pre></div>
</div>
<p>To utilize routines of
MPI / Hybrid parallelization version, the modules can be called as folows:</p>
<div class="highlight-fortran"><div class="highlight"><pre><span class="k">USE </span><span class="nv">pkomega_cg_r</span>
<span class="k">USE </span><span class="nv">pkomega_cg_c</span>
<span class="k">USE </span><span class="nv">pkomega_cocg</span>
<span class="k">USE </span><span class="nv">pkomega_bicg</span>
</pre></div>
</div>
<p>When we call <span class="math">\(K\omega\)</span> from C/C++ codes,
we should include the header file as</p>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">#include komega_cg_r.h</span>
<span class="cp">#include komega_cg_c.h</span>
<span class="cp">#include komega_cocg.h</span>
<span class="cp">#include komega_bicg.h</span>
</pre></div>
</div>
<p>Scaler arguments should be passed as pointers.
For MPI/Hybrid parallelized routine,
the above line becomes</p>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">#include pkomega_cg_r.h</span>
<span class="cp">#include pkomega_cg_c.h</span>
<span class="cp">#include pkomega_cocg.h</span>
<span class="cp">#include pkomega_bicg.h</span>
</pre></div>
</div>
<p>Also the communicator argument for the routine should be
transformed from the C/C++&#8217;s one to the fortran&#8217;s one as follows.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">comm_f</span> <span class="o">=</span> <span class="n">MPI_Comm_c2f</span><span class="p">(</span><span class="n">comm_c</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="details-of-each-routines">
<h2>Details of each routines<a class="headerlink" href="#details-of-each-routines" title="Permalink to this headline">¶</a></h2>
<div class="section" id="init">
<span id="id1"></span><h3>*_init<a class="headerlink" href="#init" title="Permalink to this headline">¶</a></h3>
<p>Set and initialize internal variables in libraries. These routines
should be called first before solving the shifted equation.</p>
<p>Syntax</p>
<blockquote>
<div><p>Fortran (Serial/OpenMP)</p>
<div class="highlight-fortran"><div class="highlight"><pre><span class="k">CALL </span><span class="nv">komega_cg_r_init</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span> <span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="nv">itermax</span><span class="p">,</span> <span class="nv">threshold</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">komega_cg_c_init</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span> <span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="nv">itermax</span><span class="p">,</span> <span class="nv">threshold</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">komega_cocg_init</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span> <span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="nv">itermax</span><span class="p">,</span> <span class="nv">threshold</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">komega_bicg_init</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span> <span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="nv">itermax</span><span class="p">,</span> <span class="nv">threshold</span><span class="p">)</span>
</pre></div>
</div>
<p>Fortran (MPI/Hybrid parallel)</p>
<div class="highlight-fortran"><div class="highlight"><pre><span class="k">CALL </span><span class="nv">pkomega_cg_r_init</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span> <span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="nv">itermax</span><span class="p">,</span> <span class="nv">threshold</span><span class="p">,</span> <span class="nv">comm</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">pkomega_cg_c_init</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span> <span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="nv">itermax</span><span class="p">,</span> <span class="nv">threshold</span><span class="p">,</span> <span class="nv">comm</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">pkomega_cocg_init</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span> <span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="nv">itermax</span><span class="p">,</span> <span class="nv">threshold</span><span class="p">,</span> <span class="nv">comm</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">pkomega_bicg_init</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span> <span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="nv">itermax</span><span class="p">,</span> <span class="nv">threshold</span><span class="p">,</span> <span class="nv">comm</span><span class="p">)</span>
</pre></div>
</div>
<p>C/C++ Serial/OpenMP</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">komega_cg_r_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ndim</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nz</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">itermax</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">threshold</span><span class="p">);</span>
<span class="n">komega_cg_c_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ndim</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nz</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">itermax</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">threshold</span><span class="p">);</span>
<span class="n">komega_cocg_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ndim</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nz</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">itermax</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">threshold</span><span class="p">);</span>
<span class="n">komega_bicg_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ndim</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nz</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">itermax</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">threshold</span><span class="p">);</span>
</pre></div>
</div>
<p>C/C++ MPI/Hybrid parallel</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">pkomega_cg_r_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ndim</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nz</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">itermax</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">threshold</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">comm</span><span class="p">);</span>
<span class="n">pkomega_cg_c_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ndim</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nz</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">itermax</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">threshold</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">comm</span><span class="p">);</span>
<span class="n">pkomega_cocg_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ndim</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nz</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">itermax</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">threshold</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">comm</span><span class="p">);</span>
<span class="n">pkomega_bicg_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ndim</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nz</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">itermax</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">threshold</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">comm</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>Parameters</p>
<blockquote>
<div><div class="highlight-fortran"><div class="highlight"><pre><span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">ndim</span>
</pre></div>
</div>
<blockquote>
<div>The dimension of solution vectors for the linearized equation.
<tt class="docutils literal"><span class="pre">ndim</span></tt> for the dimension of variables in other routine is
equal to this.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">nl</span>
</pre></div>
</div>
<blockquote>
<div>The dimension of projected solution vectors.
<tt class="docutils literal"><span class="pre">nl</span></tt> for the dimension of variables in other routine is
equal to this.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">nz</span>
</pre></div>
</div>
<blockquote>
<div>The number of shifted points.
<tt class="docutils literal"><span class="pre">nz</span></tt> for the dimension of variables in other routine is
equal to this.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">x</span><span class="p">(</span><span class="nv">nl</span><span class="o">*</span><span class="nv">nz</span><span class="p">)</span> <span class="c">! (for &quot;CG_R_init&quot;, &quot;CG_C_init&quot;)</span>
<span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">x</span><span class="p">(</span><span class="nv">nl</span><span class="o">*</span><span class="nv">nz</span><span class="p">)</span> <span class="c">! (for other cases)</span>
</pre></div>
</div>
<blockquote>
<div>The solution vector. In this procedure, <tt class="docutils literal"><span class="pre">0</span></tt> vector is returned.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">z</span><span class="p">(</span><span class="nv">nz</span><span class="p">)</span> <span class="c">! (for &quot;CG_R_init&quot;, &quot;CG_C_init&quot;)</span>
<span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">z</span><span class="p">(</span><span class="nv">nz</span><span class="p">)</span> <span class="c">! (for other cases)</span>
</pre></div>
</div>
<blockquote>
<div>Shifted points.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">itermax</span>
</pre></div>
</div>
<blockquote>
<div>The maximum iteration number for allocating arrays for the restart calculation.
When <tt class="docutils literal"><span class="pre">itermax=0</span></tt> , these arrays are not allocated,
and the restart calculation described later becomes unavailable.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">threshold</span>
</pre></div>
</div>
<blockquote>
<div>The threshold value for the convergence determination.
When the 2-norm of the residual vector for the seed equation
becomes smaller than this value, the calculation is finished.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">comm</span>
</pre></div>
</div>
<blockquote>
<div>Only for MPI / Hybrid parallelization
version. Communicators for MPI such as <tt class="docutils literal"><span class="pre">MPI_COMM_WORLD</span></tt>.</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="restart">
<span id="id2"></span><h3>*_restart<a class="headerlink" href="#restart" title="Permalink to this headline">¶</a></h3>
<p>For the restart calculation, these routines are used instead of <a class="reference internal" href="#init"><em>*_init</em></a>.
Set and initialize internal variables in libraries.
These routines should be called first before solving the shifted equation.</p>
<p>Syntax</p>
<blockquote>
<div><p>Fortran (Serial/OpenMP)</p>
<div class="highlight-fortran"><div class="highlight"><pre><span class="k">CALL </span><span class="nv">komega_cg_r_restart</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span> <span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="nv">itermax</span><span class="p">,</span> <span class="nv">threshold</span><span class="p">,</span> <span class="nv">status</span><span class="p">,</span> <span class="p">&amp;</span>
<span class="p">&amp;</span>                 <span class="nv">iter_old</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">v12</span><span class="p">,</span> <span class="nv">alpha_save</span><span class="p">,</span> <span class="nv">beta_save</span><span class="p">,</span> <span class="nv">z_seed</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">komega_cg_c_restart</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span> <span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="nv">itermax</span><span class="p">,</span> <span class="nv">threshold</span><span class="p">,</span> <span class="nv">status</span><span class="p">,</span> <span class="p">&amp;</span>
<span class="p">&amp;</span>                 <span class="nv">iter_old</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">v12</span><span class="p">,</span> <span class="nv">alpha_save</span><span class="p">,</span> <span class="nv">beta_save</span><span class="p">,</span> <span class="nv">z_seed</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">komega_cocg_restart</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span> <span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="nv">itermax</span><span class="p">,</span> <span class="nv">threshold</span><span class="p">,</span> <span class="nv">status</span><span class="p">,</span> <span class="p">&amp;</span>
<span class="p">&amp;</span>                 <span class="nv">iter_old</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">v12</span><span class="p">,</span> <span class="nv">alpha_save</span><span class="p">,</span> <span class="nv">beta_save</span><span class="p">,</span> <span class="nv">z_seed</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">komega_bicg_restart</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span> <span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="nv">itermax</span><span class="p">,</span> <span class="nv">threshold</span><span class="p">,</span> <span class="nv">status</span><span class="p">,</span> <span class="p">&amp;</span>
<span class="p">&amp;</span>                 <span class="nv">iter_old</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">v12</span><span class="p">,</span> <span class="nv">v4</span><span class="p">,</span> <span class="nv">v14</span><span class="p">,</span> <span class="nv">alpha_save</span><span class="p">,</span> <span class="nv">beta_save</span><span class="p">,</span> <span class="p">&amp;</span>
<span class="p">&amp;</span>                 <span class="nv">z_seed</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
</pre></div>
</div>
<p>Fortran (MPI/hybrid parallel)</p>
<div class="highlight-fortran"><div class="highlight"><pre><span class="k">CALL </span><span class="nv">pkomega_cg_r_restart</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span> <span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="nv">itermax</span><span class="p">,</span> <span class="nv">threshold</span><span class="p">,</span> <span class="nv">comm</span><span class="p">,</span> <span class="nv">status</span><span class="p">,</span> <span class="p">&amp;</span>
<span class="p">&amp;</span>                 <span class="nv">iter_old</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">v12</span><span class="p">,</span> <span class="nv">alpha_save</span><span class="p">,</span> <span class="nv">beta_save</span><span class="p">,</span> <span class="nv">z_seed</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">pkomega_cg_c_restart</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span> <span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="nv">itermax</span><span class="p">,</span> <span class="nv">threshold</span><span class="p">,</span> <span class="nv">comm</span><span class="p">,</span> <span class="nv">status</span><span class="p">,</span> <span class="p">&amp;</span>
<span class="p">&amp;</span>                 <span class="nv">iter_old</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">v12</span><span class="p">,</span> <span class="nv">alpha_save</span><span class="p">,</span> <span class="nv">beta_save</span><span class="p">,</span> <span class="nv">z_seed</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">pkomega_cocg_restart</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span> <span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="nv">itermax</span><span class="p">,</span> <span class="nv">threshold</span><span class="p">,</span> <span class="nv">comm</span><span class="p">,</span> <span class="nv">status</span><span class="p">,</span> <span class="p">&amp;</span>
<span class="p">&amp;</span>                 <span class="nv">iter_old</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">v12</span><span class="p">,</span> <span class="nv">alpha_save</span><span class="p">,</span> <span class="nv">beta_save</span><span class="p">,</span> <span class="nv">z_seed</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">pkomega_bicg_restart</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span> <span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="nv">itermax</span><span class="p">,</span> <span class="nv">threshold</span><span class="p">,</span> <span class="nv">comm</span><span class="p">,</span> <span class="nv">status</span><span class="p">,</span> <span class="p">&amp;</span>
<span class="p">&amp;</span>                 <span class="nv">iter_old</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">v12</span><span class="p">,</span> <span class="nv">v4</span><span class="p">,</span> <span class="nv">v14</span><span class="p">,</span> <span class="nv">alpha_save</span><span class="p">,</span> <span class="nv">beta_save</span><span class="p">,</span> <span class="p">&amp;</span>
<span class="p">&amp;</span>                 <span class="nv">z_seed</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
</pre></div>
</div>
<p>C/C++ (Serial/OpenMP)</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">komega_cg_r_restart</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ndim</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nz</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">itermax</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">threshold</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="o">&amp;</span>
<span class="o">&amp;</span>                 <span class="o">&amp;</span><span class="n">iter_old</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v12</span><span class="p">,</span> <span class="n">alpha_save</span><span class="p">,</span> <span class="n">beta_save</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">z_seed</span><span class="p">,</span> <span class="n">r_l_save</span><span class="p">);</span>
<span class="n">komega_cg_c_restart</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ndim</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nz</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">itermax</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">threshold</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="o">&amp;</span>
<span class="o">&amp;</span>                 <span class="o">&amp;</span><span class="n">iter_old</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v12</span><span class="p">,</span> <span class="n">alpha_save</span><span class="p">,</span> <span class="n">beta_save</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">z_seed</span><span class="p">,</span> <span class="n">r_l_save</span><span class="p">);</span>
<span class="n">komega_cocg_restart</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ndim</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nz</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">itermax</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">threshold</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="o">&amp;</span>
<span class="o">&amp;</span>                 <span class="o">&amp;</span><span class="n">iter_old</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v12</span><span class="p">,</span> <span class="n">alpha_save</span><span class="p">,</span> <span class="n">beta_save</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">z_seed</span><span class="p">,</span> <span class="n">r_l_save</span><span class="p">);</span>
<span class="n">komega_bicg_restart</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ndim</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nz</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">itermax</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">threshold</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="o">&amp;</span>
<span class="o">&amp;</span>                 <span class="o">&amp;</span><span class="n">iter_old</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v12</span><span class="p">,</span> <span class="n">v4</span><span class="p">,</span> <span class="n">v14</span><span class="p">,</span> <span class="n">alpha_save</span><span class="p">,</span> <span class="n">beta_save</span><span class="p">,</span> <span class="o">&amp;</span>
<span class="o">&amp;</span>                 <span class="o">&amp;</span><span class="n">z_seed</span><span class="p">,</span> <span class="n">r_l_save</span><span class="p">);</span>
</pre></div>
</div>
<p>C/C++ (MPI/hybrid parallel)</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">pkomega_cg_r_restart</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ndim</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nz</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">itermax</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">threshold</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="o">&amp;</span>
<span class="o">&amp;</span>                 <span class="o">&amp;</span><span class="n">iter_old</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v12</span><span class="p">,</span> <span class="n">alpha_save</span><span class="p">,</span> <span class="n">beta_save</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">z_seed</span><span class="p">,</span> <span class="n">r_l_save</span><span class="p">);</span>
<span class="n">pkomega_cg_c_restart</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ndim</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nz</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">itermax</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">threshold</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="o">&amp;</span>
<span class="o">&amp;</span>                 <span class="o">&amp;</span><span class="n">iter_old</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v12</span><span class="p">,</span> <span class="n">alpha_save</span><span class="p">,</span> <span class="n">beta_save</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">z_seed</span><span class="p">,</span> <span class="n">r_l_save</span><span class="p">);</span>
<span class="n">pkomega_cocg_restart</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ndim</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nz</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">itermax</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">threshold</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="o">&amp;</span>
<span class="o">&amp;</span>                 <span class="o">&amp;</span><span class="n">iter_old</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v12</span><span class="p">,</span> <span class="n">alpha_save</span><span class="p">,</span> <span class="n">beta_save</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">z_seed</span><span class="p">,</span> <span class="n">r_l_save</span><span class="p">);</span>
<span class="n">pkomega_bicg_restart</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ndim</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nz</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">itermax</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">threshold</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">comm</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="o">&amp;</span>
<span class="o">&amp;</span>                 <span class="o">&amp;</span><span class="n">iter_old</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v12</span><span class="p">,</span> <span class="n">v4</span><span class="p">,</span> <span class="n">v14</span><span class="p">,</span> <span class="n">alpha_save</span><span class="p">,</span> <span class="n">beta_save</span><span class="p">,</span> <span class="o">&amp;</span>
<span class="o">&amp;</span>                 <span class="o">&amp;</span><span class="n">z_seed</span><span class="p">,</span> <span class="n">r_l_save</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>Parameters</p>
<blockquote>
<div><div class="highlight-fortran"><div class="highlight"><pre><span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">ndim</span>
<span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">nl</span>
<span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">nz</span>
<span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">x</span><span class="p">(</span><span class="nv">nl</span><span class="o">*</span><span class="nv">nz</span><span class="p">)</span>
<span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">z</span><span class="p">(</span><span class="nv">nz</span><span class="p">)</span> <span class="c">! (for &quot;CG_R_restart&quot;, &quot;CG_C_restart&quot;)</span>
<span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">z</span><span class="p">(</span><span class="nv">nz</span><span class="p">)</span> <span class="c">! (Other)</span>
<span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">itermax</span>
<span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">threshold</span>
<span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">comm</span>
</pre></div>
</div>
<blockquote>
<div>The definition is same as <a class="reference internal" href="#init"><em>*_init</em></a>. See the parameters in <a class="reference internal" href="#init"><em>*_init</em></a>.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">status</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><p>The error code is returned.</p>
<p>First component(<tt class="docutils literal"><span class="pre">status(1)</span></tt>)</p>
<blockquote>
<div>If the solution is converged or a breakdown occurs,
the current total number of iteration with the minus sign is returned.
In other cases, this routine returns the current total number of iteration.
The calculation is continuable only when <tt class="docutils literal"><span class="pre">status(1)</span></tt> is the positive value;
otherwise the result is meaningless even if the calculation is continued.</div></blockquote>
<p>Second component(<tt class="docutils literal"><span class="pre">status(2)</span></tt>)</p>
<blockquote>
<div><tt class="docutils literal"><span class="pre">1</span></tt> is returned if <tt class="docutils literal"><span class="pre">itermax</span></tt> is set as a finite value and the
convergence condition is not satisfied at the <tt class="docutils literal"><span class="pre">itermax</span></tt>-th iteration.
<tt class="docutils literal"><span class="pre">2</span></tt> is returned if <span class="math">\(\alpha\)</span> diverges.
<tt class="docutils literal"><span class="pre">3</span></tt> is returned if <span class="math">\(\pi_{\rm seed}\)</span> becomes 0.
In the case of <tt class="docutils literal"><span class="pre">COCG_restart</span></tt> or <tt class="docutils literal"><span class="pre">BiCG_restart</span></tt>,
<tt class="docutils literal"><span class="pre">4</span></tt> is returned if the residual vector and the shadow residual vector are orthogonal.
In other cases, <tt class="docutils literal"><span class="pre">0</span></tt> is returned.</div></blockquote>
<p>Third component(<tt class="docutils literal"><span class="pre">status(3)</span></tt>)</p>
<blockquote>
<div>The index of the seed point is returned.</div></blockquote>
</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">iter_old</span>
</pre></div>
</div>
<blockquote>
<div>The number of iteration for the previous calculation.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">v2</span><span class="p">(</span><span class="nv">ndim</span><span class="p">)</span> <span class="c">! (for &quot;CG_R_restart&quot;)</span>
<span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">v2</span><span class="p">(</span><span class="nv">ndim</span><span class="p">)</span> <span class="c">! (Other)</span>
</pre></div>
</div>
<blockquote>
<div>The residual vector at the last step for the previous calculation.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">v12</span><span class="p">(</span><span class="nv">ndim</span><span class="p">)</span> <span class="c">! (for &quot;CG_R_restart&quot;)</span>
<span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">v12</span><span class="p">(</span><span class="nv">ndim</span><span class="p">)</span> <span class="c">! (Other)</span>
</pre></div>
</div>
<blockquote>
<div>The residual vector at the second from the last step for the previous calculation.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">alpha_save</span><span class="p">(</span><span class="nv">iter_old</span><span class="p">)</span> <span class="c">! (for &quot;CG_R_restart&quot;, &quot;CG_C_restart&quot;)</span>
<span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">alpha_save</span><span class="p">(</span><span class="nv">iter_old</span><span class="p">)</span> <span class="c">! (Other)</span>
</pre></div>
</div>
<blockquote>
<div>The parameters <span class="math">\(\alpha\)</span> obtained by the
previous calculation at each steps by (Bi)CG methods.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">beta_save</span><span class="p">(</span><span class="nv">iter_old</span><span class="p">)</span> <span class="c">! (for &quot;CG_R_restart&quot;, &quot;CG_C_restart&quot;)</span>
<span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">beta_save</span><span class="p">(</span><span class="nv">iter_old</span><span class="p">)</span> <span class="c">! (Other)</span>
</pre></div>
</div>
<blockquote>
<div>The parameters <span class="math">\(\beta\)</span> obtained
by the previous calculation at each steps by (Bi)CG methods.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">z_seed</span> <span class="c">! (for &quot;CG_R_restart&quot;, &quot;CG_C_restart&quot;)</span>
<span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">z_seed</span> <span class="c">! (Other)</span>
</pre></div>
</div>
<blockquote>
<div>The value of the seed shift for the previous calculation.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">r_l_save</span><span class="p">(</span><span class="nv">nl</span><span class="p">,</span><span class="nv">iter_old</span><span class="p">)</span> <span class="c">! (for &quot;CG_R_restart&quot;)</span>
<span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">r_l_save</span><span class="p">(</span><span class="nv">nl</span><span class="p">,</span><span class="nv">iter_old</span><span class="p">)</span> <span class="c">! (Other)</span>
</pre></div>
</div>
<blockquote>
<div>The projected residual vector at each iteration for the previous calculation.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">v4</span><span class="p">(</span><span class="nv">ndim</span><span class="p">)</span> <span class="c">! (for &quot;CG_R_restart&quot;)</span>
<span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">v4</span><span class="p">(</span><span class="nv">ndim</span><span class="p">)</span> <span class="c">! (Other)</span>
</pre></div>
</div>
<blockquote>
<div>The shadow residual vector at the last step for the previous calculation.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">v14</span><span class="p">(</span><span class="nv">ndim</span><span class="p">)</span> <span class="c">! (for &quot;CG_R_restart&quot;)</span>
<span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">v14</span><span class="p">(</span><span class="nv">ndim</span><span class="p">)</span> <span class="c">! (Other)</span>
</pre></div>
</div>
<blockquote>
<div>The shadow residual vector at the second last step for the previous calculation.</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="update">
<span id="id3"></span><h3>*_update<a class="headerlink" href="#update" title="Permalink to this headline">¶</a></h3>
<p>It is called alternately with the matrix-vector product
in the loop and updates the solution.</p>
<p>Syntax</p>
<blockquote>
<div><p>Fortran (Serial/OpenMPI)</p>
<div class="highlight-fortran"><div class="highlight"><pre><span class="k">CALL </span><span class="nv">komega_cg_r_update</span><span class="p">(</span><span class="nv">v12</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">r_l</span><span class="p">,</span> <span class="nv">status</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">komega_cg_c_update</span><span class="p">(</span><span class="nv">v12</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">r_l</span><span class="p">,</span> <span class="nv">status</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">komega_cocg_update</span><span class="p">(</span><span class="nv">v12</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">r_l</span><span class="p">,</span> <span class="nv">status</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">komega_bicg_update</span><span class="p">(</span><span class="nv">v12</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">v14</span><span class="p">,</span> <span class="nv">v4</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">r_l</span><span class="p">,</span> <span class="nv">status</span><span class="p">)</span>
</pre></div>
</div>
<p>Fortran (MPI/hybrid parallel)</p>
<div class="highlight-fortran"><div class="highlight"><pre><span class="k">CALL </span><span class="nv">pkomega_cg_r_update</span><span class="p">(</span><span class="nv">v12</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">r_l</span><span class="p">,</span> <span class="nv">status</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">pkomega_cg_c_update</span><span class="p">(</span><span class="nv">v12</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">r_l</span><span class="p">,</span> <span class="nv">status</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">pkomega_cocg_update</span><span class="p">(</span><span class="nv">v12</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">r_l</span><span class="p">,</span> <span class="nv">status</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">pkomega_bicg_update</span><span class="p">(</span><span class="nv">v12</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">v14</span><span class="p">,</span> <span class="nv">v4</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">r_l</span><span class="p">,</span> <span class="nv">status</span><span class="p">)</span>
</pre></div>
</div>
<p>C/C++ (Serial/OpenMPI)</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">komega_cg_r_update</span><span class="p">(</span><span class="n">v12</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">r_l</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
<span class="n">komega_cg_c_update</span><span class="p">(</span><span class="n">v12</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">r_l</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
<span class="n">komega_cocg_update</span><span class="p">(</span><span class="n">v12</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">r_l</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
<span class="n">komega_bicg_update</span><span class="p">(</span><span class="n">v12</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v14</span><span class="p">,</span> <span class="n">v4</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">r_l</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
</pre></div>
</div>
<p>C/C++ (MPI/hybrid parallel)</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">pkomega_cg_r_update</span><span class="p">(</span><span class="n">v12</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">r_l</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
<span class="n">pkomega_cg_c_update</span><span class="p">(</span><span class="n">v12</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">r_l</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
<span class="n">pkomega_cocg_update</span><span class="p">(</span><span class="n">v12</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">r_l</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
<span class="n">pkomega_bicg_update</span><span class="p">(</span><span class="n">v12</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v14</span><span class="p">,</span> <span class="n">v4</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">r_l</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>Parameters</p>
<blockquote>
<div><div class="highlight-fortran"><div class="highlight"><pre><span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">v12</span><span class="p">(</span><span class="nv">ndim</span><span class="p">)</span> <span class="c">! (for &quot;CG_R_update&quot;)</span>
<span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">v12</span><span class="p">(</span><span class="nv">ndim</span><span class="p">)</span> <span class="c">! (Other)</span>
</pre></div>
</div>
<blockquote>
<div>The product of the residual vector (<tt class="docutils literal"><span class="pre">v2</span></tt>) and the matrix.
This routine returns the 2-norm of the updated residual vector
as a first element of this array.
This returned value is used, for examples, for printing the convergence profile.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">v2</span><span class="p">(</span><span class="nv">ndim</span><span class="p">)</span> <span class="c">! (for &quot;CG_R_update&quot;)</span>
<span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">v2</span><span class="p">(</span><span class="nv">ndim</span><span class="p">)</span> <span class="c">! (Other)</span>
</pre></div>
</div>
<blockquote>
<div>The residual vector is input and the updated residual vector is output.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">v14</span><span class="p">(</span><span class="nv">ndim</span><span class="p">)</span> <span class="c">! (for &quot;CG_R_update&quot;)</span>
<span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">v14</span><span class="p">(</span><span class="nv">ndim</span><span class="p">)</span> <span class="c">! (Other)</span>
</pre></div>
</div>
<blockquote>
<div>The product of the shadow residual vector (<tt class="docutils literal"><span class="pre">v4</span></tt>) and the matrix is input.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">v4</span><span class="p">(</span><span class="nv">ndim</span><span class="p">)</span> <span class="c">! (for &quot;CG_R_update&quot;)</span>
<span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">INOUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">v4</span><span class="p">(</span><span class="nv">ndim</span><span class="p">)</span> <span class="c">! (Other)</span>
</pre></div>
</div>
<blockquote>
<div>The shadow residual vector is input and the updated vector is output.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">status</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><p>The error code is returned.</p>
<p>First component (<tt class="docutils literal"><span class="pre">status(1)</span></tt>)</p>
<blockquote>
<div>If the solution is converged or a breakdown occurs,
the current total number of iteration with the minus sign is returned.
In other cases,
this routine returns the current total number of iteration.
The calculation is continuable only when <tt class="docutils literal"><span class="pre">status(1)</span></tt> is the positive value;
otherwise the result is meaningless even if the calculation is continued.</div></blockquote>
<p>Second component (<tt class="docutils literal"><span class="pre">status(2)</span></tt>)</p>
<blockquote>
<div><tt class="docutils literal"><span class="pre">1</span></tt> is returned if <tt class="docutils literal"><span class="pre">itermax</span></tt> is set as a finite value in the
<a class="reference internal" href="#init"><em>*_init</em></a> routine and the convergence condition is not satisfied
at the <tt class="docutils literal"><span class="pre">itermax</span></tt>-th iteration.
<tt class="docutils literal"><span class="pre">2</span></tt> is returned if <span class="math">\(\alpha\)</span> diverges.
<tt class="docutils literal"><span class="pre">3</span></tt> is returned if <span class="math">\(\pi_{\rm seed}\)</span> becomes 0.
In the case of <tt class="docutils literal"><span class="pre">COCG_update</span></tt> or <tt class="docutils literal"><span class="pre">BiCG_update</span></tt>,
<tt class="docutils literal"><span class="pre">4</span></tt> is returned if the residual vector and
the shadow residual vector are orthogonal.
In other cases, <tt class="docutils literal"><span class="pre">0</span></tt> is returned.</div></blockquote>
<p>Third component (<tt class="docutils literal"><span class="pre">status(3)</span></tt>)</p>
<blockquote>
<div>The index of the seed point is returned.</div></blockquote>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="getcoef">
<span id="id4"></span><h3>*_getcoef<a class="headerlink" href="#getcoef" title="Permalink to this headline">¶</a></h3>
<p>Get the coefficients used in the restart calculation.
To call these routines,
<tt class="docutils literal"><span class="pre">itermax</span></tt> in <a class="reference internal" href="#init"><em>*_init</em></a> routine must not be <tt class="docutils literal"><span class="pre">0</span></tt> .</p>
<p>The total number of iteration (<tt class="docutils literal"><span class="pre">iter_old</span></tt>) used in this routine
is computed by using <tt class="docutils literal"><span class="pre">status</span></tt> which is an output of <a class="reference internal" href="#update"><em>*_update</em></a> as follows:</p>
<div class="highlight-fortran"><div class="highlight"><pre><span class="nv">iter_old</span> <span class="o">=</span> <span class="nb">ABS</span><span class="p">(</span><span class="nv">status</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>Syntax</p>
<blockquote>
<div><p>Fortran (Serial/OpenMP)</p>
<div class="highlight-fortran"><div class="highlight"><pre><span class="k">CALL </span><span class="nv">komega_cg_r_getcoef</span><span class="p">(</span><span class="nv">alpha_save</span><span class="p">,</span> <span class="nv">beta_save</span><span class="p">,</span> <span class="nv">z_seed</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">komega_cg_c_getcoef</span><span class="p">(</span><span class="nv">alpha_save</span><span class="p">,</span> <span class="nv">beta_save</span><span class="p">,</span> <span class="nv">z_seed</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">komega_cocg_getcoef</span><span class="p">(</span><span class="nv">alpha_save</span><span class="p">,</span> <span class="nv">beta_save</span><span class="p">,</span> <span class="nv">z_seed</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">komega_bicg_getcoef</span><span class="p">(</span><span class="nv">alpha_save</span><span class="p">,</span> <span class="nv">beta_save</span><span class="p">,</span> <span class="nv">z_seed</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
</pre></div>
</div>
<p>Fortran (MPI/hybrid parallel)</p>
<div class="highlight-fortran"><div class="highlight"><pre><span class="k">CALL </span><span class="nv">pkomega_cg_r_getcoef</span><span class="p">(</span><span class="nv">alpha_save</span><span class="p">,</span> <span class="nv">beta_save</span><span class="p">,</span> <span class="nv">z_seed</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">pkomega_cg_c_getcoef</span><span class="p">(</span><span class="nv">alpha_save</span><span class="p">,</span> <span class="nv">beta_save</span><span class="p">,</span> <span class="nv">z_seed</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">pkomega_cocg_getcoef</span><span class="p">(</span><span class="nv">alpha_save</span><span class="p">,</span> <span class="nv">beta_save</span><span class="p">,</span> <span class="nv">z_seed</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">pkomega_bicg_getcoef</span><span class="p">(</span><span class="nv">alpha_save</span><span class="p">,</span> <span class="nv">beta_save</span><span class="p">,</span> <span class="nv">z_seed</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
</pre></div>
</div>
<p>C/C++ (Serial/OpenMP)</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">komega_cg_r_getcoef</span><span class="p">(</span><span class="n">alpha_save</span><span class="p">,</span> <span class="n">beta_save</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">z_seed</span><span class="p">,</span> <span class="n">r_l_save</span><span class="p">);</span>
<span class="n">komega_cg_c_getcoef</span><span class="p">(</span><span class="n">alpha_save</span><span class="p">,</span> <span class="n">beta_save</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">z_seed</span><span class="p">,</span> <span class="n">r_l_save</span><span class="p">);</span>
<span class="n">komega_cocg_getcoef</span><span class="p">(</span><span class="n">alpha_save</span><span class="p">,</span> <span class="n">beta_save</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">z_seed</span><span class="p">,</span> <span class="n">r_l_save</span><span class="p">);</span>
<span class="n">komega_bicg_getcoef</span><span class="p">(</span><span class="n">alpha_save</span><span class="p">,</span> <span class="n">beta_save</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">z_seed</span><span class="p">,</span> <span class="n">r_l_save</span><span class="p">);</span>
</pre></div>
</div>
<p>C/C++ (MPI/hybrid parallel)</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">pkomega_cg_r_getcoef</span><span class="p">(</span><span class="n">alpha_save</span><span class="p">,</span> <span class="n">beta_save</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">z_seed</span><span class="p">,</span> <span class="n">r_l_save</span><span class="p">);</span>
<span class="n">pkomega_cg_c_getcoef</span><span class="p">(</span><span class="n">alpha_save</span><span class="p">,</span> <span class="n">beta_save</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">z_seed</span><span class="p">,</span> <span class="n">r_l_save</span><span class="p">);</span>
<span class="n">pkomega_cocg_getcoef</span><span class="p">(</span><span class="n">alpha_save</span><span class="p">,</span> <span class="n">beta_save</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">z_seed</span><span class="p">,</span> <span class="n">r_l_save</span><span class="p">);</span>
<span class="n">pkomega_bicg_getcoef</span><span class="p">(</span><span class="n">alpha_save</span><span class="p">,</span> <span class="n">beta_save</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">z_seed</span><span class="p">,</span> <span class="n">r_l_save</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>Parameters</p>
<blockquote>
<div><div class="highlight-fortran"><div class="highlight"><pre><span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">alpha_save</span><span class="p">(</span><span class="nv">iter_old</span><span class="p">)</span> <span class="c">! (for &quot;CG_R_restart&quot;, &quot;CG_C_restart&quot;)</span>
<span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">alpha_save</span><span class="p">(</span><span class="nv">iter_old</span><span class="p">)</span> <span class="c">! (Other)</span>
</pre></div>
</div>
<blockquote>
<div>The parameters <span class="math">\(\alpha\)</span> of the (Bi)CG method at each iteration.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">beta_save</span><span class="p">(</span><span class="nv">iter_old</span><span class="p">)</span> <span class="c">! (for &quot;CG_R_restart&quot;, &quot;CG_C_restart&quot;)</span>
<span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">beta_save</span><span class="p">(</span><span class="nv">iter_old</span><span class="p">)</span> <span class="c">! (Other)</span>
</pre></div>
</div>
<blockquote>
<div>The parameters <span class="math">\(\beta\)</span> of the (Bi)CG method at each iteration.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">z_seed</span> <span class="c">! (for &quot;CG_R_restart&quot;, &quot;CG_C_restart&quot;)</span>
<span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">z_seed</span> <span class="c">! (Other)</span>
</pre></div>
</div>
<blockquote>
<div>Seed shift.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">r_l_save</span><span class="p">(</span><span class="nv">nl</span><span class="p">,</span><span class="nv">iter_old</span><span class="p">)</span> <span class="c">! (&quot;CG_R_restart&quot;)</span>
<span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">IN</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">r_l_save</span><span class="p">(</span><span class="nv">nl</span><span class="p">,</span><span class="nv">iter_old</span><span class="p">)</span> <span class="c">! (Other)</span>
</pre></div>
</div>
<blockquote>
<div>The projected residual vectors at each iteration.</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="getvec">
<span id="id5"></span><h3>*_getvec<a class="headerlink" href="#getvec" title="Permalink to this headline">¶</a></h3>
<p>Get the residual vectors to use the restart calculation.
To call these routines,
<tt class="docutils literal"><span class="pre">itermax</span></tt> in the <a class="reference internal" href="#init"><em>*_init</em></a> routine must not be <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
<p>Syntax</p>
<blockquote>
<div><p>Fortran (Serial/OpenMP)</p>
<div class="highlight-fortran"><div class="highlight"><pre><span class="k">CALL </span><span class="nv">komega_cg_r_getvec</span><span class="p">(</span><span class="nv">r_old</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">komega_cg_c_getvec</span><span class="p">(</span><span class="nv">r_old</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">komega_cocg_getvec</span><span class="p">(</span><span class="nv">r_old</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">komega_bicg_getvec</span><span class="p">(</span><span class="nv">r_old</span><span class="p">,</span> <span class="nv">r_tilde_old</span><span class="p">)</span>
</pre></div>
</div>
<p>Fortran (MPI/hybrid parallel)</p>
<div class="highlight-fortran"><div class="highlight"><pre><span class="k">CALL </span><span class="nv">pkomega_cg_r_getvec</span><span class="p">(</span><span class="nv">r_old</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">pkomega_cg_c_getvec</span><span class="p">(</span><span class="nv">r_old</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">pkomega_cocg_getvec</span><span class="p">(</span><span class="nv">r_old</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">pkomega_bicg_getvec</span><span class="p">(</span><span class="nv">r_old</span><span class="p">,</span> <span class="nv">r_tilde_old</span><span class="p">)</span>
</pre></div>
</div>
<p>C/C++ (Serial/OpenMP)</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">komega_cg_r_getvec</span><span class="p">(</span><span class="n">r_old</span><span class="p">);</span>
<span class="n">komega_cg_c_getvec</span><span class="p">(</span><span class="n">r_old</span><span class="p">);</span>
<span class="n">komega_cocg_getvec</span><span class="p">(</span><span class="n">r_old</span><span class="p">);</span>
<span class="n">komega_bicg_getvec</span><span class="p">(</span><span class="n">r_old</span><span class="p">,</span> <span class="n">r_tilde_old</span><span class="p">);</span>
</pre></div>
</div>
<p>C/C++ (MPI/hybrid parallel)</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">pkomega_cg_r_getvec</span><span class="p">(</span><span class="n">r_old</span><span class="p">);</span>
<span class="n">pkomega_cg_c_getvec</span><span class="p">(</span><span class="n">r_old</span><span class="p">);</span>
<span class="n">pkomega_cocg_getvec</span><span class="p">(</span><span class="n">r_old</span><span class="p">);</span>
<span class="n">pkomega_bicg_getvec</span><span class="p">(</span><span class="n">r_old</span><span class="p">,</span> <span class="n">r_tilde_old</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>Parameters</p>
<blockquote>
<div><div class="highlight-fortran"><div class="highlight"><pre><span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">r_old</span><span class="p">(</span><span class="nv">ndim</span><span class="p">)</span> <span class="c">! (for &quot;CG_R_getvec&quot;)</span>
<span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">r_old</span><span class="p">(</span><span class="nv">ndim</span><span class="p">)</span> <span class="c">! (Other)</span>
</pre></div>
</div>
<blockquote>
<div>The residual vector at the second last step in the previous calculation.</div></blockquote>
<div class="highlight-fortran"><div class="highlight"><pre><span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">r_tilde_old</span><span class="p">(</span><span class="nv">ndim</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div>The shadow residual vector at the second last step in the previous calculation.</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="getresidual">
<h3>*_getresidual<a class="headerlink" href="#getresidual" title="Permalink to this headline">¶</a></h3>
<p>Get the values of 2-norm of the residual vector at each shift points.
These routines can be called from anywhere between <a class="reference internal" href="#init"><em>*_init</em></a>
and <a class="reference internal" href="#finalize"><em>*_finalize</em></a> .
These routines do not affect the calculation results.</p>
<p>Syntax</p>
<blockquote>
<div><p>Fortran (Serial/OpenMP)</p>
<div class="highlight-fortran"><div class="highlight"><pre><span class="k">CALL </span><span class="nv">komega_cg_r_getresidual</span><span class="p">(</span><span class="nv">res</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">komega_cg_c_getresidual</span><span class="p">(</span><span class="nv">res</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">komega_cocg_getresidual</span><span class="p">(</span><span class="nv">res</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">komega_bicg_getresidual</span><span class="p">(</span><span class="nv">res</span><span class="p">)</span>
</pre></div>
</div>
<p>Fortran (MPI/hybrid parallel)</p>
<div class="highlight-fortran"><div class="highlight"><pre><span class="k">CALL </span><span class="nv">pkomega_cg_r_getresidual</span><span class="p">(</span><span class="nv">res</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">pkomega_cg_c_getresidual</span><span class="p">(</span><span class="nv">res</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">pkomega_cocg_getresidual</span><span class="p">(</span><span class="nv">res</span><span class="p">)</span>
<span class="k">CALL </span><span class="nv">pkomega_bicg_getresidual</span><span class="p">(</span><span class="nv">res</span><span class="p">)</span>
</pre></div>
</div>
<p>C/C++ (Serial/OpenMP)</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">komega_cg_r_getresidual</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
<span class="n">komega_cg_c_getresidual</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
<span class="n">komega_cocg_getresidual</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
<span class="n">komega_bicg_getresidual</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
</pre></div>
</div>
<p>C/C++ (MPI/hybrid parallel)</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">pkomega_cg_r_getresidual</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
<span class="n">pkomega_cg_c_getresidual</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
<span class="n">pkomega_cocg_getresidual</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
<span class="n">pkomega_bicg_getresidual</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>Parameters</p>
<blockquote>
<div><div class="highlight-fortran"><div class="highlight"><pre><span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="nv">OUT</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">res</span><span class="p">(</span><span class="nv">nz</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div>The values of 2-norm of the residual vector at each shift points are
returned.</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="finalize">
<span id="id6"></span><h3>*_finalize<a class="headerlink" href="#finalize" title="Permalink to this headline">¶</a></h3>
<p>Release memories of the arrays stored in the library.</p>
<p>Syntax</p>
<blockquote>
<div><p>Fortran (Serial/OpenMP)</p>
<div class="highlight-fortran"><div class="highlight"><pre><span class="k">CALL </span><span class="nv">komega_cg_r_finalize</span><span class="p">()</span>
<span class="k">CALL </span><span class="nv">komega_cg_c_finalize</span><span class="p">()</span>
<span class="k">CALL </span><span class="nv">komega_cocg_finalize</span><span class="p">()</span>
<span class="k">CALL </span><span class="nv">komega_bicg_finalize</span><span class="p">()</span>
</pre></div>
</div>
<p>Fortran (MPI/hybrid parallel)</p>
<div class="highlight-fortran"><div class="highlight"><pre><span class="k">CALL </span><span class="nv">pkomega_cg_r_finalize</span><span class="p">()</span>
<span class="k">CALL </span><span class="nv">pkomega_cg_c_finalize</span><span class="p">()</span>
<span class="k">CALL </span><span class="nv">pkomega_cocg_finalize</span><span class="p">()</span>
<span class="k">CALL </span><span class="nv">pkomega_bicg_finalize</span><span class="p">()</span>
</pre></div>
</div>
<p>C/C++ (Serial/OpenMP)</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">komega_cg_r_finalize</span><span class="p">();</span>
<span class="n">komega_cg_c_finalize</span><span class="p">();</span>
<span class="n">komega_cocg_finalize</span><span class="p">();</span>
<span class="n">komega_bicg_finalize</span><span class="p">();</span>
</pre></div>
</div>
<p>C/C++ (MPI/hybrid parallel)</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">pkomega_cg_r_finalize</span><span class="p">();</span>
<span class="n">pkomega_cg_c_finalize</span><span class="p">();</span>
<span class="n">pkomega_cocg_finalize</span><span class="p">();</span>
<span class="n">pkomega_bicg_finalize</span><span class="p">();</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="sample-codes-for-using-shifted-bicg-library">
<h2>Sample codes for using shifted BiCG library<a class="headerlink" href="#sample-codes-for-using-shifted-bicg-library" title="Permalink to this headline">¶</a></h2>
<p>As a typical example, the usage of shifted BiCG library is shown below.</p>
<div class="highlight-fortran"><div class="highlight"><pre><span class="k">PROGRAM </span><span class="nv">my_prog</span>
  <span class="c">!</span>
  <span class="k">USE </span><span class="nv">komega_bicg</span><span class="p">,</span> <span class="nv">ONLY</span> <span class="p">:</span> <span class="nv">komega_bicg_init</span><span class="p">,</span> <span class="nv">komega_bicg_restart</span><span class="p">,</span> <span class="p">&amp;</span>
  <span class="p">&amp;</span>                       <span class="nv">komega_bicg_update</span><span class="p">,</span> <span class="nv">komega_bicg_getcoef</span><span class="p">,</span> <span class="p">&amp;</span>
  <span class="p">&amp;</span>                       <span class="nv">komega_bicg_getvec</span><span class="p">,</span> <span class="nv">komega_bicg_finalize</span>
  <span class="k">USE </span><span class="nv">solve_cc_routines</span><span class="p">,</span> <span class="nv">ONLY</span> <span class="p">:</span> <span class="nv">input_size</span><span class="p">,</span> <span class="nv">input_restart</span><span class="p">,</span> <span class="p">&amp;</span>
  <span class="p">&amp;</span>                             <span class="nv">projection</span><span class="p">,</span> <span class="p">&amp;</span>
  <span class="p">&amp;</span>                             <span class="nv">hamiltonian_prod</span><span class="p">,</span> <span class="nv">generate_system</span><span class="p">,</span> <span class="p">&amp;</span>
  <span class="p">&amp;</span>                             <span class="nv">output_restart</span><span class="p">,</span> <span class="nv">output_result</span>
  <span class="c">!</span>
  <span class="k">IMPLICIT NONE</span>
  <span class="c">!</span>
  <span class="kt">INTEGER</span><span class="p">,</span><span class="k">SAVE</span> <span class="kd">::</span> <span class="p">&amp;</span>
  <span class="p">&amp;</span> <span class="nv">ndim</span><span class="p">,</span>    <span class="p">&amp;</span> <span class="c">! Size of Hilvert space</span>
  <span class="p">&amp;</span> <span class="nv">nz</span><span class="p">,</span>      <span class="p">&amp;</span> <span class="c">! Number of frequencies</span>
  <span class="p">&amp;</span> <span class="nv">nl</span><span class="p">,</span>      <span class="p">&amp;</span> <span class="c">! Number of Left vector</span>
  <span class="p">&amp;</span> <span class="nv">itermax</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">! Max. number of iteraction</span>
  <span class="p">&amp;</span> <span class="nv">iter_old</span>   <span class="c">! Number of iteraction of previous run</span>
  <span class="c">!</span>
  <span class="kt">REAL</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">SAVE</span> <span class="kd">::</span> <span class="p">&amp;</span>
  <span class="p">&amp;</span> <span class="nv">threshold</span> <span class="c">! Convergence Threshold</span>
  <span class="c">!</span>
  <span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">SAVE</span> <span class="kd">::</span> <span class="p">&amp;</span>
  <span class="p">&amp;</span> <span class="nv">z_seed</span> <span class="c">! Seed frequency</span>
  <span class="c">!</span>
  <span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">ALLOCATABLE</span><span class="p">,</span><span class="k">SAVE</span> <span class="kd">::</span> <span class="p">&amp;</span>
  <span class="p">&amp;</span> <span class="nv">z</span><span class="p">(:)</span>         <span class="c">! (nz): Frequency</span>
  <span class="c">!</span>
  <span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">ALLOCATABLE</span><span class="p">,</span><span class="k">SAVE</span> <span class="kd">::</span> <span class="p">&amp;</span>
  <span class="p">&amp;</span> <span class="nv">ham</span><span class="p">(:,:),</span> <span class="p">&amp;</span>
  <span class="p">&amp;</span> <span class="nv">rhs</span><span class="p">(:),</span> <span class="p">&amp;</span>
  <span class="p">&amp;</span> <span class="nv">v12</span><span class="p">(:),</span> <span class="nv">v2</span><span class="p">(:),</span> <span class="p">&amp;</span> <span class="c">! (ndim): Working vector</span>
  <span class="p">&amp;</span> <span class="nv">v14</span><span class="p">(:),</span> <span class="nv">v4</span><span class="p">(:),</span> <span class="p">&amp;</span> <span class="c">! (ndim): Working vector</span>
  <span class="p">&amp;</span> <span class="nv">r_l</span><span class="p">(:),</span> <span class="p">&amp;</span> <span class="c">! (nl) : Projeccted residual vector</span>
  <span class="p">&amp;</span> <span class="nv">x</span><span class="p">(:,:)</span> <span class="c">! (nl,nz) : Projected result</span>
  <span class="c">!</span>
  <span class="c">! Variables for Restart</span>
  <span class="c">!</span>
  <span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">ALLOCATABLE</span><span class="p">,</span><span class="k">SAVE</span> <span class="kd">::</span> <span class="p">&amp;</span>
  <span class="p">&amp;</span> <span class="nv">alpha</span><span class="p">(:),</span> <span class="nv">beta</span><span class="p">(:)</span> <span class="c">! (iter_old)</span>
  <span class="c">!</span>
  <span class="kt">COMPLEX</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="k">ALLOCATABLE</span><span class="p">,</span><span class="k">SAVE</span> <span class="kd">::</span> <span class="p">&amp;</span>
  <span class="p">&amp;</span> <span class="nv">r_l_save</span><span class="p">(:,:)</span> <span class="c">! (nl,iter_old) Projected residual vectors</span>
  <span class="c">!</span>
  <span class="c">! Variables for Restart</span>
  <span class="c">!</span>
  <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="p">&amp;</span>
  <span class="p">&amp;</span> <span class="nv">iter</span><span class="p">,</span>    <span class="p">&amp;</span> <span class="c">! Counter for Iteration</span>
  <span class="p">&amp;</span> <span class="nv">status</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="c">!</span>
  <span class="kt">LOGICAL</span> <span class="kd">::</span> <span class="p">&amp;</span>
  <span class="p">&amp;</span> <span class="nv">restart_in</span><span class="p">,</span> <span class="p">&amp;</span> <span class="c">! If .TRUE., sestart from the previous result</span>
  <span class="p">&amp;</span> <span class="nv">restart_out</span>   <span class="c">! If .TRUE., save datas for the next run</span>
  <span class="c">!</span>
  <span class="c">! Input Size of vectors, numerical conditions</span>
  <span class="c">!</span>
  <span class="k">CALL </span><span class="nv">input_size</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span><span class="nv">nl</span><span class="p">,</span><span class="nv">nz</span><span class="p">)</span>
  <span class="k">CALL </span><span class="nv">input_condition</span><span class="p">(</span><span class="nv">itermax</span><span class="p">,</span><span class="nv">threshold</span><span class="p">,</span><span class="nv">restart_in</span><span class="p">,</span><span class="nv">restart_out</span><span class="p">)</span>
  <span class="c">!</span>
  <span class="k">ALLOCATE</span><span class="p">(</span><span class="nv">v12</span><span class="p">(</span><span class="nv">ndim</span><span class="p">),</span> <span class="nv">v2</span><span class="p">(</span><span class="nv">ndim</span><span class="p">),</span> <span class="nv">v14</span><span class="p">(</span><span class="nv">ndim</span><span class="p">),</span> <span class="nv">v4</span><span class="p">(</span><span class="nv">ndim</span><span class="p">),</span> <span class="nv">r_l</span><span class="p">(</span><span class="nv">nl</span><span class="p">),</span> <span class="p">&amp;</span>
  <span class="p">&amp;</span>        <span class="nv">x</span><span class="p">(</span><span class="nv">nl</span><span class="p">,</span><span class="nv">nz</span><span class="p">),</span> <span class="nv">z</span><span class="p">(</span><span class="nv">nz</span><span class="p">),</span> <span class="nv">ham</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span><span class="nv">ndim</span><span class="p">),</span> <span class="nv">rhs</span><span class="p">(</span><span class="nv">ndim</span><span class="p">))</span>
  <span class="c">!</span>
  <span class="k">CALL </span><span class="nv">generate_system</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span> <span class="nv">ham</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">,</span> <span class="nv">z</span><span class="p">)</span>
  <span class="c">!</span>
  <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
  <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s2">&quot;#####  CG Initialization  #####&quot;</span>
  <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
  <span class="c">!</span>
  <span class="k">IF</span><span class="p">(</span><span class="nv">restart_in</span><span class="p">)</span> <span class="k">THEN</span>
    <span class="c">!</span>
    <span class="k">CALL </span><span class="nv">input_restart</span><span class="p">(</span><span class="nv">iter_old</span><span class="p">,</span> <span class="nv">zseed</span><span class="p">,</span> <span class="nv">alpha</span><span class="p">,</span> <span class="nv">beta</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
    <span class="c">!</span>
    <span class="k">IF</span><span class="p">(</span><span class="nv">restart_out</span><span class="p">)</span> <span class="k">THEN</span>
<span class="k">       CALL </span><span class="nv">komega_bicg_restart</span><span class="p">(</span> <span class="p">&amp;</span>
       <span class="p">&amp;</span>    <span class="nv">ndim</span><span class="p">,</span> <span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="nv">itermax</span><span class="p">,</span> <span class="nv">threshold</span><span class="p">,</span> <span class="p">&amp;</span>
       <span class="p">&amp;</span>    <span class="nv">status</span><span class="p">,</span> <span class="nv">iter_old</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">v12</span><span class="p">,</span> <span class="nv">v4</span><span class="p">,</span> <span class="nv">v14</span><span class="p">,</span> <span class="nv">alpha</span><span class="p">,</span> <span class="p">&amp;</span>
       <span class="p">&amp;</span>    <span class="nv">beta</span><span class="p">,</span> <span class="nv">z_seed</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
    <span class="k">ELSE</span>
<span class="k">       CALL </span><span class="nv">komega_bicg_restart</span><span class="p">(</span> <span class="p">&amp;</span>
       <span class="p">&amp;</span>    <span class="nv">ndim</span><span class="p">,</span> <span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">threshold</span><span class="p">,</span> <span class="p">&amp;</span>
       <span class="p">&amp;</span>    <span class="nv">status</span><span class="p">,</span> <span class="nv">iter_old</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">v12</span><span class="p">,</span> <span class="nv">v4</span><span class="p">,</span> <span class="nv">v14</span><span class="p">,</span> <span class="nv">alpha</span><span class="p">,</span> <span class="p">&amp;</span>
       <span class="p">&amp;</span>    <span class="nv">beta</span><span class="p">,</span> <span class="nv">z_seed</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
    <span class="k">END IF</span>
    <span class="c">!</span>
    <span class="c">! These vectors were saved in BiCG routine</span>
    <span class="c">!</span>
    <span class="k">DEALLOCATE</span><span class="p">(</span><span class="nv">alpha</span><span class="p">,</span> <span class="nv">beta</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
    <span class="c">!</span>
    <span class="k">IF</span><span class="p">(</span><span class="nv">status</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">GOTO </span><span class="mi">10</span>
    <span class="c">!</span>
  <span class="k">ELSE</span>
     <span class="c">!</span>
     <span class="c">! Generate Right Hand Side Vector</span>
     <span class="c">!</span>
     <span class="nv">v2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nv">ndim</span><span class="p">)</span> <span class="o">=</span> <span class="nv">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nv">ndim</span><span class="p">)</span>
     <span class="nv">v4</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nv">ndim</span><span class="p">)</span> <span class="o">=</span> <span class="nb">CONJG</span><span class="p">(</span><span class="nv">v2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nv">ndim</span><span class="p">))</span>
     <span class="c">!v4(1:ndim) = v2(1:ndim)</span>
     <span class="c">!</span>
     <span class="k">IF</span><span class="p">(</span><span class="nv">restart_out</span><span class="p">)</span> <span class="k">THEN</span>
<span class="k">        CALL </span><span class="nv">komega_bicg_init</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span> <span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="nv">termax</span><span class="p">,</span> <span class="nv">threshold</span><span class="p">)</span>
     <span class="k">ELSE</span>
<span class="k">        CALL </span><span class="nv">komega_bicg_init</span><span class="p">(</span><span class="nv">ndim</span><span class="p">,</span> <span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">threshold</span><span class="p">)</span>
     <span class="k">END IF</span>
     <span class="c">!</span>
  <span class="k">END IF</span>
  <span class="c">!</span>
  <span class="c">! BiCG Loop</span>
  <span class="c">!</span>
  <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
  <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s2">&quot;#####  CG Iteration  #####&quot;</span>
  <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
  <span class="c">!</span>
  <span class="k">DO </span><span class="nv">iter</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">itermax</span>
     <span class="c">!</span>
     <span class="c">! Projection of Residual vector into the space</span>
     <span class="c">! spaned by left vectors</span>
     <span class="c">!</span>
     <span class="nv">r_l</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nv">nl</span><span class="p">)</span> <span class="o">=</span> <span class="nv">projection</span><span class="p">(</span><span class="nv">v2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nv">nl</span><span class="p">))</span>
     <span class="c">!</span>
     <span class="c">! Matrix-vector product</span>
     <span class="c">!</span>
     <span class="k">CALL </span><span class="nv">hamiltonian_prod</span><span class="p">(</span><span class="nv">Ham</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">v12</span><span class="p">)</span>
     <span class="k">CALL </span><span class="nv">hamiltonian_prod</span><span class="p">(</span><span class="nv">Ham</span><span class="p">,</span> <span class="nv">v4</span><span class="p">,</span> <span class="nv">v14</span><span class="p">)</span>
     <span class="c">!</span>
     <span class="c">! Update result x with BiCG</span>
     <span class="c">!</span>
     <span class="k">CALL </span><span class="nv">komega_bicg_update</span><span class="p">(</span><span class="nv">v12</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">v14</span><span class="p">,</span> <span class="nv">v4</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">r_l</span><span class="p">,</span> <span class="nv">status</span><span class="p">)</span>
     <span class="c">!</span>
     <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(a,i,a,3i,a,e15.5)&#39;</span><span class="p">)</span> <span class="s2">&quot;lopp : &quot;</span><span class="p">,</span> <span class="nv">iter</span><span class="p">,</span> <span class="p">&amp;</span>
     <span class="p">&amp;</span>                             <span class="s2">&quot;, status : &quot;</span><span class="p">,</span> <span class="nv">status</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span> <span class="p">&amp;</span>
     <span class="p">&amp;</span>                             <span class="s2">&quot;, Res. : &quot;</span><span class="p">,</span> <span class="nb">DBLE</span><span class="p">(</span><span class="nv">v12</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
     <span class="k">IF</span><span class="p">(</span><span class="nv">status</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">EXIT</span>
     <span class="c">!</span>
  <span class="k">END DO</span>
  <span class="c">!</span>
  <span class="k">IF</span><span class="p">(</span><span class="nv">status</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">THEN</span>
<span class="k">     WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s2">&quot;  Converged in iteration &quot;</span><span class="p">,</span> <span class="nb">ABS</span><span class="p">(</span><span class="nv">status</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
  <span class="k">ELSE IF</span><span class="p">(</span><span class="nv">status</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span>
<span class="k">     WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s2">&quot;  Not Converged in iteration &quot;</span><span class="p">,</span> <span class="nb">ABS</span><span class="p">(</span><span class="nv">status</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
  <span class="k">ELSE IF</span><span class="p">(</span><span class="nv">status</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">THEN</span>
<span class="k">     WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s2">&quot;  Alpha becomes infinity&quot;</span><span class="p">,</span> <span class="nb">ABS</span><span class="p">(</span><span class="nv">status</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
  <span class="k">ELSE IF</span><span class="p">(</span><span class="nv">status</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="k">THEN</span>
<span class="k">     WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s2">&quot;  Pi_seed becomes zero&quot;</span><span class="p">,</span> <span class="nb">ABS</span><span class="p">(</span><span class="nv">status</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
  <span class="k">ELSE IF</span><span class="p">(</span><span class="nv">status</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="k">THEN</span>
<span class="k">  WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s2">&quot;  Residual &amp; Shadow residual are orthogonal&quot;</span><span class="p">,</span> <span class="p">&amp;</span>
  <span class="p">&amp;</span>          <span class="nb">ABS</span><span class="p">(</span><span class="nv">status</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
  <span class="k">END IF</span>
  <span class="c">!</span>
  <span class="c">! Total number of iteration</span>
  <span class="c">!</span>
  <span class="nv">iter_old</span> <span class="o">=</span> <span class="nb">ABS</span><span class="p">(</span><span class="nv">status</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
  <span class="c">!</span>
  <span class="c">! Get these vectors for restart in the Next run</span>
  <span class="c">!</span>
  <span class="k">IF</span><span class="p">(</span><span class="nv">restart_out</span><span class="p">)</span> <span class="k">THEN</span>
     <span class="c">!</span>
     <span class="k">ALLOCATE</span><span class="p">(</span><span class="nv">alpha</span><span class="p">(</span><span class="nv">iter_old</span><span class="p">),</span> <span class="nv">beta</span><span class="p">(</span><span class="nv">iter_old</span><span class="p">),</span> <span class="nv">r_l_save</span><span class="p">(</span><span class="nv">nl</span><span class="p">,</span><span class="nv">iter_old</span><span class="p">))</span>
     <span class="c">!</span>
     <span class="k">CALL </span><span class="nv">komega_bicg_getcoef</span><span class="p">(</span><span class="nv">alpha</span><span class="p">,</span> <span class="nv">beta</span><span class="p">,</span> <span class="nv">z_seed</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
     <span class="k">CALL </span><span class="nv">komega_bicg_getvec</span><span class="p">(</span><span class="nv">v12</span><span class="p">,</span><span class="nv">v14</span><span class="p">)</span>
     <span class="c">!</span>
     <span class="k">CALL </span><span class="nv">output_restart</span><span class="p">(</span><span class="nv">iter_old</span><span class="p">,</span> <span class="nv">z_seed</span><span class="p">,</span> <span class="nv">alpha</span><span class="p">,</span> <span class="nv">beta</span><span class="p">,</span> <span class="p">&amp;</span>
     <span class="p">&amp;</span>                   <span class="nv">r_l_save</span><span class="p">,</span> <span class="nv">v12</span><span class="p">,</span> <span class="nv">v14</span><span class="p">)</span>
     <span class="c">!</span>
     <span class="k">DEALLOCATE</span><span class="p">(</span><span class="nv">alpha</span><span class="p">,</span> <span class="nv">beta</span><span class="p">,</span> <span class="nv">r_l_save</span><span class="p">)</span>
     <span class="c">!</span>
  <span class="k">END IF</span>
  <span class="c">!</span>
<span class="mi">10</span> <span class="k">CONTINUE</span>
  <span class="c">!</span>
  <span class="c">! Deallocate all intrinsic vectors</span>
  <span class="c">!</span>
  <span class="k">CALL </span><span class="nv">komega_bicg_finalize</span><span class="p">()</span>
  <span class="c">!</span>
  <span class="c">! Output to a file</span>
  <span class="c">!</span>
  <span class="k">CALL </span><span class="nv">output_result</span><span class="p">(</span><span class="nv">nl</span><span class="p">,</span> <span class="nv">nz</span><span class="p">,</span> <span class="nv">z</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">r_l</span><span class="p">)</span>
  <span class="c">!</span>
  <span class="k">DEALLOCATE</span><span class="p">(</span><span class="nv">v12</span><span class="p">,</span> <span class="nv">v2</span><span class="p">,</span> <span class="nv">v14</span><span class="p">,</span> <span class="nv">v4</span><span class="p">,</span> <span class="nv">r_l</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">z</span><span class="p">)</span>
  <span class="c">!</span>
  <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
  <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s2">&quot;#####  Done  #####&quot;</span>
  <span class="k">WRITE</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
  <span class="c">!</span>
<span class="k">END PROGRAM </span><span class="nv">my_prog</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/komega.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Usage</a><ul>
<li><a class="reference internal" href="#details-of-each-routines">Details of each routines</a><ul>
<li><a class="reference internal" href="#init">*_init</a></li>
<li><a class="reference internal" href="#restart">*_restart</a></li>
<li><a class="reference internal" href="#update">*_update</a></li>
<li><a class="reference internal" href="#getcoef">*_getcoef</a></li>
<li><a class="reference internal" href="#getvec">*_getvec</a></li>
<li><a class="reference internal" href="#getresidual">*_getresidual</a></li>
<li><a class="reference internal" href="#finalize">*_finalize</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sample-codes-for-using-shifted-bicg-library">Sample codes for using shifted BiCG library</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="komega_workflow_en.html"
                        title="previous chapter">Schematic workflow of this library</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="komega_contact_en.html"
                        title="next chapter">Contact</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/komega_usage_en.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="komega_contact_en.html" title="Contact"
             >next</a> |</li>
        <li class="right" >
          <a href="komega_workflow_en.html" title="Schematic workflow of this library"
             >previous</a> |</li>
        <li><a href="index.html">komega 1.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2017, kawamura.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>